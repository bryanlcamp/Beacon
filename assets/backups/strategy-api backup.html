<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beacon Financial Technologies. Strategy Example.</title>
  <!-- Shared design system -->
  <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>
    <script>window.BEACON_PAGE_TITLE = "Strategy API.";</script>
  <header class="beacon-page-header"></header>
  <script src="/assets/js/beacon-header.js"></script>
  <script src="/assets/js/beacon-info-dropdown.js"></script>
  <main class="beacon-page-content">
    <section class="doc-hero">
      <h1>Strategy API.</h1>
      <p>One simple interface. Plug in your strategy. Test new ideas.<br>Beacon framework quickly gives you risk-free insight.</p>
    </section>
    <section class="doc-content">
      <h2 class="mb05">Example C++ API Usage:</h2>
      <div class="beacon-code-panel">
        <div id="code-grid" class="code-grid-demo"></div>
      </div>
      <script>
        // --- Configurable method expanders ---
        const expandableMethods = [
          {
            name: 'onMarketDataReceived',
            signature: 'void onMarketDataReceived(const bo::MarketMessage& msg) override {}',
            expandedSignature: 'void onMarketDataReceived(const bo::MarketMessage& msg) override {',
            todo: [
              '// Reused for cache locality.',
              '// It must be repopulated. Intentionally omitted.',
              '_reusedOrder->reset();',
              '',
              '// This is your method.',
              'process(msg);'
            ]
          },
          {
            name: 'onOrderFilled',
            signature: 'void onOrderFilled(const bo::OrderFill& fill) override {}',
            expandedSignature: 'void onOrderFilled(const bo::OrderFill& fill) override {',
            todo: [
              '// Callback from OrderManager.'
            ]
          },
          {
            name: 'onOrderConfirmed',
            signature: 'void onOrderConfirmed(const bo::Order& order) override {}',
            expandedSignature: 'void onOrderConfirmed(const bo::Order& order) override {',
            todo: [
              '// Callback from OrderManager.'
            ]
          },
          {
            name: 'onOrderRejected',
            signature: 'void onOrderRejected(const bo::OrderRequest& req) override {}',
            expandedSignature: 'void onOrderRejected(const bo::OrderRequest& req) override {',
            todo: [
              '// Callback from OrderManager.'
            ]
          },
          {
            name: 'onExchangeMessageReceived',
            signature: 'void onExchangeMessageReceived(const bo::ExchangeMessage& msg) override {}',
            expandedSignature: 'void onExchangeMessageReceived(const bo::ExchangeMessage& msg) override {',
            todo: [
              '// Callback from OrderManager.',
              '// Simulate exchange halts, violations, etc.',
              '_orderManager->CancelAll();'
            ]
          },
          {
            name: 'onOrderConfirmed',
            signature: 'void onOrderConfirmed(const bo::Order& order) override {}',
            expandedSignature: 'void onOrderConfirmed(const bo::Order& order) override {',
            todo: [
              '// Callback from OrderManager.'
            ]
          }
        ];
        // --- End config ---
        // (removed duplicate assignment)
        const code = `#pragma once\n\n#include <beacon_strategy>\n#include <beacon_order>\n\n// - Namespace abbreviations for readability.\nnamespace bs = beacon_strategy;\nnamespace bo = beacon_order;\n\n// - overrides are for template/concepts.\n// - Some pointer intialization omitted for clarity.\n\nclass ExampleStrategy : public bs::StrategyBase {\npublic:\n    // - Opportunity to read your own .json.\n    explicit ExampleStrategy(const nlohmann::json& config) : bs::StrategyBase(config) {}\n\n    void onMarketDataReceived(const bo::MarketMessage& msg) override {}\n    void onOrderConfirmed(const bo::Order& order) override {}\n    void onOrderFilled(const bo::OrderFill& fill) override {}\n    void onOrderRejected(const bo::OrderRequest& req) override {}\n    void onExchangeMessageReceived(const bo::ExchangeMessage& msg) override {}\n\nprivate:\n    // - All messaging between the strategy and matching engine.\n    // - Ownership is implementation-specific.\n    std::unique_ptr<bo::OrderManager> _orderManager;\n\n    // - Reused for cache locality purposes.\n    bo::Order _reusedOrder;\n};\n\n// - For static template polymorphism.\nREGISTER_ALGORITHM(ExampleStrategy);`;
        let expandedState = {};
        expandableMethods.forEach(m => expandedState[m.name] = false);
        function htmlEscape(str) {
          return str.replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
        }
        function getIndent(line) {
          const match = line.match(/^(\s*)/);
          return match ? match[1] : '';
        }
        function renderGrid() {
          const lines = code.split('\n');
          let html = '';
          for (let i = 0; i < lines.length; ++i) {
            let rawLine = lines[i];
            let line = htmlEscape(rawLine);
            let matchedMethod = expandableMethods.find(m => rawLine.trim() === m.signature);
            if (matchedMethod) {
              const triangle = expandedState[matchedMethod.name] ? '▼' : '▶';
              const indent = getIndent(rawLine).replace(/ /g, '&nbsp;');
              if (!expandedState[matchedMethod.name]) {
                html += `<div class=\"code-row\"><span class=\"expander\" data-expander=\"${matchedMethod.name}\">${triangle}</span><span>${indent}<span style=\"color:#6bb6ff;\">${matchedMethod.signature.replace('void ', 'void ')}</span></span></div>`;
              } else {
                html += `<div class=\"code-row\"><span class=\"expander\" data-expander=\"${matchedMethod.name}\">${triangle}</span><span>${indent}<span style=\"color:#6bb6ff;\">${matchedMethod.expandedSignature.replace('void ', 'void ')}</span></span></div>`;
                const bodyIndent = indent + '    ';
                matchedMethod.todo.forEach(lineText => {
                  html += `<div class=\"code-row\"><span class=\"expander invisible\"></span><span>${bodyIndent.replace(/ /g, '&nbsp;')}${htmlEscape(lineText)}</span></div>`;
                });
                html += `<div class=\"code-row\"><span class=\"expander invisible\"></span><span>${indent.replace(/ /g, '&nbsp;')}}</span></div>`;
                if (lines[i+1] && lines[i+1].trim() === '}') {
                  i++;
                }
              }
            } else {
              const indent = getIndent(rawLine).replace(/ /g, '&nbsp;');
              html += `<div class=\"code-row\"><span class=\"expander invisible\"></span><span>${indent}${line.trim()}</span></div>`;
            }
          }
          return html;
        }
        function updateGrid() {
          document.getElementById('code-grid').innerHTML = renderGrid();
        }
        document.getElementById('code-grid').onclick = function(e) {
          const expander = e.target.closest('.expander');
          if (expander && expander.dataset.expander) {
            const method = expander.dataset.expander;
            expandedState[method] = !expandedState[method];
            updateGrid();
          }
        };
        updateGrid();
      </script>
    </section>
  </main>
  <script>
    // Info icon dropdown logic (copied from Command Center)
    (function() {
      var infoBtn = document.getElementById('infoIconBtn');
      var dropdown = document.getElementById('infoDropdown');
      if (!infoBtn || !dropdown) return;
      infoBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        dropdown.style.display = (dropdown.style.display === 'block') ? 'none' : 'block';
      });
      document.addEventListener('click', function(e) {
        if (!infoBtn.contains(e.target) && !dropdown.contains(e.target)) {
          dropdown.style.display = 'none';
        }
      });
      infoBtn.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') dropdown.style.display = 'none';
      });
    })();
  </script>
</body>
</html>

